{% extends 'Admin_header.html' %}
{% block addr %}Leave{% endblock addr %}
{% block user %}Welcome, {{request.session.name}}{% endblock user %}
{% block style %}
<title>WFM :: LEAVE</title>
<link rel="stylesheet" href="../static/css/dataTables.bootstrap.min.css" />
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.0.1/css/buttons.dataTables.min.css">
<style>
    /* #myTable1 thead tr {
        background: #f9f9f9 !important;
    }

    #myTable1 tr th,
    #myTable1 tr td {
        border: 1px solid #f5f5f5;
    } */

    .dataTables_wrapper .row:nth-child(2) {
        width: 100%;
    }

    .dataTables_length label,
    .dataTables_filter label {
        display: flex;
    }

    .nav-item {
        width: 100%;
        max-width: 101px;
        text-align: center;
    }

    .nav-link {
        background: #e2e2e2;
        border-radius: 10px !important;
        border-bottom: 5px solid #ccc;
    }

    .notes {
        /* min-width: 410px; */
        min-width: 300px;
        width: 100%;
        white-space: pre-line;
        word-break: break-word;
        text-align: center;
    }

    .red {
        color: red;
        font-weight: 700;
    }

    .green {
        color: green;
        font-weight: 700;
    }

    .black {
        color: #333;
        font-weight: 700;
    }

    .top-nav-search .btn {
        top: 12%
    }

    a.adminLeaveColor {
        background: #09796b;
        color: #fff !important;
    }

    a.adminLeaveColor:hover {
        background: #09796b;
        color: #fff !important;
    }

    .select2-container--default .select2-selection--single {
        border-color: #e3e3e3;
        box-shadow: none;
        font-size: 15px;
        height: 35px;
    }

    .form-control {
        height: 33px;
    }

    .color-change::placeholder {
        color: #09697b;
        font-style: italic;
    }

    .mdlbtn {
        background-color: rgb(212, 64, 64);
        border-radius: 12%;
        font-weight: 600;
        color: white;
        width: 100px;
    }

    .showEmail {
        /* background-color: #09796b;    */
        border-radius: 7%;
        font-weight: 600;
        color: black;
        width: 520px;
        padding: 5px;
    }



   

    .modal-content {
        position: relative;
        display: -ms-flexbox;
        display: flex;
        -ms-flex-direction: column;
        flex-direction: column;
        width: 140%;
        pointer-events: auto;
        background-color: #fff;
        background-clip: padding-box;
        border: 1px solid rgba(0, 0, 0, .2);
        border-radius: .3rem;
        outline: 0;
        min-height: 360px;
        /* height: 50%; */
    }

    /* .truncate p {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 100px;
    } */

    [data-title]:hover:after {
        opacity: 1;
        transition: all 0.1s ease 0.5s;
        visibility: visible;
    }

    [data-title]::after {
        content: attr(data-title);
        word-break: break-all;
        position: absolute;
        padding: 6px 11px 8px 10px;
        color: rgb(49, 48, 48);
        white-space: break-spaces;
        -moz-border-radius: 5px;
        -webkit-border-radius: 5px;
        border-radius: 5px;
        -moz-box-shadow: 0px 0px 4px #666;
        -webkit-box-shadow: 0px 0px 4px #666;
        box-shadow: 0px 0px 4px #666;
        opacity: 0;
        z-index: 99999;
        visibility: hidden;
        right: 24px;
        top: 15px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 44em;
        background-color: rgb(226, 222, 222);
        color: rgb(44, 43, 43);
        font-family: 'Optima, sans-serif';
        font-weight: 50;
    }

    [data-title] {
        position: relative;
        font-size: large;
    }

    .lnr-bubble:hover {
        background-color: rgb(223, 223, 222);
        border-radius: 35%;
    }

    .modal-body {
        position: relative;
        -ms-flex: 1 1 auto;
        flex: 1 1 auto;
        padding: 1rem;
        /* margin-top: -2%; */
        overflow: auto;
    }

    

    .table-responsive {
        display: block;
        width: 100%;
        overflow-x: auto;
        height: 383px;
    }

    table.dataTable {
        clear: both;
        margin-top: 6px !important;
        margin-bottom: 6px !important;
        max-width: none !important;
        border-collapse: separate !important;
        border-spacing: 0px;
        width: 100% !important;
    }
    .tdcolor:hover {
        background-color: rgb(219, 214, 214) !important;
    }

    .thcolor:hover {
        background-color: white !important;
    }

    /* #cnlbtn {
        width: 85px;
        /* margin-top: 2px;
     */

    .drkclick {
        background-color: rgb(202, 178, 178) !important;
    }

    .btninline {
        display: ruby;
    }
    .card-header {
        background: none;
        padding: 0.7rem;
        border-bottom: 1px solid #ededed;
    }
    .card-title {
        color: #333;
        position: relative;
        left: 10px;
    }
    .pageinationAdj {
        position: relative;
        top: 0px;
    }
    .firsttop {
        padding: 0.8rem;
    }
    #defbodyshow{
        word-wrap: break-word;
        white-space: collapse;
        margin-top: -4%;
    }
    #modalEmail,#xyzshow {
        word-wrap: break-word;
        white-space: collapse;
    }
@media only screen and (max-width: 1199px){
    .card-title.mb-0 {
        font-size: 18px;
        font-weight: 600;
    }
    label, .thcolor, #myTable1_info, #myTable3_info, #myTable2_info {
        font-size: 13px;
    }
    .form-control {
        height: 30px;
        font-size: 13px;
    }
    .tdcolor.odd, .tdcolor.even, .pagination {
        font-size: 12px;
    }
    
}
    @media only screen and (max-width: 991px){  
        #showsidebar,
        #fullscreen {
            display: none;
        }
        .card.ctm-border-radius.shadow-sm {
            position: relative;
            top: 30px;
        }
        .card {
            border: 1px solid #ededed;
            margin-bottom: 13px;
            border-radius: 10px;
        }
        .lowerfooter {
            position: relative;
            top: 25px;
            margin-bottom: 35px !important;
        }
    }
    @media only screen and (max-width: 767px){
        .pageinationAdj {
             display: flow-root;
        }
        #cnlbtn, .btn.btn-theme.button-1.text-white.ctm-border-radius.ApproveText {
            font-size: 13px !important;
            position: relative;
            top: 4px;
        }
    }
    @media only screen and (max-width: 487px){
        .pageinationAdj {
            display: inline-block;
        }
        #cnlbtn, .btn.btn-theme.button-1.text-white.ctm-border-radius.ApproveText {
            font-size: 10px !important;
            /* position: relative;
            top: 4px; */
        }
    }
    @media only screen and (max-width: 480px){
        .card.ctm-border-radius.shadow-sm {
            position: relative;
            top: 0px;
        }
    }
</style>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
{% endblock style %}
{% block body %}
<div class="col-xl-9 col-lg-8  col-md-12 adminleave">
    <div class="quicklink-sidebar-menu ctm-border-radius shadow-sm grow bg-white card">
        <!-- hr, manager -->
        <div class="card-body align-center firsttop">
            <ul class="nav flex-row nav-pills" role="tablist">
                <li class="nav-item mr-2">
                    <a class="nav-link active mb-2" data-toggle="pill" href="#pills-hrReport" role="tab"
                        aria-controls="pills-home" aria-selected="true">HR</a>
                </li>
                <li class="nav-item mr-2">
                    <a class="nav-link" name="leave_report" data-toggle="pill" href="#pills-managerReport" role="tab"
                        aria-controls="pills-profile" aria-selected="false">Manager</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" name="leave_report" data-toggle="pill" href="#pills-empReport" role="tab"
                        aria-controls="pills-profile" aria-selected="false">Employee</a>
                </li>
            </ul>
        </div>
        <!-- End Here -->
    </div>

    <div class="card-body align-center" style="padding: unset;">
        <div class="tab-content">
            <!-- HR Section -->
            <div class="tab-pane fade show active" id="pills-hrReport" role="tabpanel" aria-labelledby="pills-home-tab">
                <div class="col-md-12" style="padding: unset;">
                    <div class="card ctm-border-radius shadow-sm grow">
                        <div class="card-header">
                            <h4 class="card-title mb-0">HR Leave Data</h4>
                        </div>
                        <div class="card-body">
                            <div class="row pageinationAdj">
                                <div class="col-md-6 data_drop1"></div>
                                <div class="col-md-6 data_search1"></div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <form method="post">
                                        {%csrf_token%}
                                        <div class="employee-office-table paginate-table1">
                                            <div class="table-responsive modalHeight">
                                                <table class="table custom-table mb-0 grid" id="myTable1">
                                                    <thead style="position: sticky; top: 0; z-index: 1;">
                                                        <tr class="thcolor">
                                                            <th>HR</th>
                                                            <th>Leave Type</th>
                                                            <th>From</th>
                                                            <th>To</th>
                                                            <th>Remaining Leaves</th>
                                                            <th>Days</th>
                                                            <th>Paid Leave</th>
                                                            <th>Status</th>
                                                            <th>Notes</th>
                                                            <th>Actions</th>
                                                            <th style="display: none;"></th>
                                                            <!-- <th style="display: none;"></th> -->
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for sl,pl,leaves in leaves_detail %}
                                                        <tr class="tdcolor">
                                                            <td>
                                                                <h2>{{leaves.emp_name}}</h2>
                                                            </td>
                                                            <td><input type="hidden"
                                                                    class="leave_type_hr leave_type_hr{{forloop.counter}}"
                                                                    value="{{leaves.leave_type}}">Sick Leave</td>
                                                            <td>{{leaves.from_dt}}</td>
                                                            <td>{{leaves.to_dt}}</td>
                                                            <td id="">
                                                                <input type="hidden" id="remainleaves"
                                                                    class="remainleaves_hr{{forloop.counter}}"
                                                                    value="{{pl}}" /><input type="hidden" id="sickleave"
                                                                    class="sickleave_hr{{forloop.counter}}"
                                                                    value="{{sl}}" />{{sl}}
                                                                SL/{{pl}}
                                                                PL
                                                            </td>
                                                            <td><input type="hidden" id="daysleave"
                                                                    class="daysleave daysleave_hr{{forloop.counter}}"
                                                                    value="{{leaves.no_of_days}}">{{leaves.no_of_days}}
                                                            </td>
                                                            <td class=""><input type="text" id="paidleave"
                                                                    class="paidleave paidleave_hr{{forloop.counter}}"
                                                                    value=""
                                                                    style="text-align: center; border: none; background: transparent;">
                                                            </td>
                                                            <td id="leave_status_hr{{forloop.counter}}"
                                                                class="status_hr{{forloop.counter}}">{{leaves.status}}
                                                            </td>
                                                            <!-- <td class="notes notes1" id="notes{{forloop.counter}}">
                                                                {{leaves.reason}}</td> -->
                                                            <td hidden class="notes notes3"
                                                                id="notes{{forloop.counter}}">{{leaves.reason}}</td>
                                                            <td><span class="showEmail lnr lnr-bubble mr-2"
                                                                    data-title="{{leaves.reason}}"></span></td>

                                                            <td class="btninline">
                                                                <div class="buttons-hide_hr{{forloop.counter}}">
                                                                    <button name="approve" style="font-size: 15px;"
                                                                        class="btn btn-theme button-1 text-white ctm-border-radius ApproveText"
                                                                        value="{{leaves.id}}">Approve</button>
                                                                </div>
                                                                <div class="buttons1-hide_hr{{forloop.counter}}">
                                                                    <button id="cnlbtn" style="font-size: 15px;"
                                                                        class="btn btn-danger text-white ctm-border-radius DenyText"
                                                                        value="{{leaves.id}}" name="reject"
                                                                        aria-label="Close">Reject</button>
                                                                </div>
                                                            </td>
                                                            <!-- <td class="buttons1-hide_hr{{forloop.counter}}">
                                                                <button id="cnlbtn" style="font-size: 15px;" class="btn btn-danger text-white ctm-border-radius DenyText"
                                                                        value="{{leaves.id}}" name="reject" aria-label="Close">Reject</button>
                                                            </td>
                                                             -->
                                                        </tr>
                                                        <div class="modal fade" id="emailModal" tabindex="-1"
                                                            aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                            <div class="modal-dialog">
                                                                <div class="modal-content">
                                                                    <div class="modal-header">
                                                                        <h5 class="modal-title" id="exampleModalLabel">
                                                                            <b>Note</b>
                                                                        </h5>
                                                                        <button type="button" class="close"
                                                                            data-dismiss="modal" aria-label="Close">
                                                                            <span aria-hidden="true">&times;</span>
                                                                        </button>
                                                                    </div>
                                                                    <div class="modal-body">
                                                                        <p id="modalEmail"></p>
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button type="button"
                                                                            class="btn btn-danger text-white ctm-border-radius mt-4"
                                                                            data-dismiss="modal">Close</button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <script>
                                                            document.getElementById('myTable1').addEventListener('click', function (event) {
                                                                const target = event.target;

                                                                if (target.classList.contains('showEmail')) {
                                                                    const row = target.parentElement.parentElement;
                                                                    const email = row.getElementsByTagName('td')[8].innerText;

                                                                    document.getElementById('modalEmail').innerText = email;
                                                                    $('#emailModal').modal('show');
                                                                }
                                                            });
                                                        </script>
                                                        <script>
                                                            $(document).ready(function () {
                                                                $(`#myTable1 .leave_type_hr`).each(function () {
                                                                    var leave_type_hr = $(`.leave_type_hr{{forloop.counter}}`).val();
                                                                    var daysleave_hr = $(`.daysleave_hr{{forloop.counter}}`).val();
                                                                    var remainleaves_hr = $(`.remainleaves_hr{{forloop.counter}}`).val();
                                                                    var sickleave_hr = $(`.sickleave_hr{{forloop.counter}}`).val();
                                                                    if (leave_type_hr == "Sick Leave") {
                                                                        // alert('{{sl}}')
                                                                        if ('{{leaves.no_of_days}}' >= '{{sl}}') {
                                                                            $(`.paidleave_hr{{forloop.counter}}`).val('{{sl}}');
                                                                        }
                                                                        else {
                                                                            $(`.paidleave_hr{{forloop.counter}}`).val('{{leaves.no_of_days}}');
                                                                        }
                                                                        if ('{{sl}}' == 0) {
                                                                            $(`.paidleave_hr{{forloop.counter}}`).val("0");
                                                                        }
                                                                    }
                                                                    if (leave_type_hr == "Parental Leave") {
                                                                        // alert(remainleaves)
                                                                        if ('{{leaves.no_of_days}}' >= 9) {
                                                                            $(`.paidleave_hr{{forloop.counter}}`).val('{{pl}}');
                                                                        }
                                                                        else {
                                                                            $(`.paidleave_hr{{forloop.counter}}`).val('{{leaves.no_of_days}}');
                                                                        }
                                                                        if ('{{pl}}' == 0) {
                                                                            $(`.paidleave_hr{{forloop.counter}}`).val("0");
                                                                        }
                                                                    }
                                                                    if (leave_type_hr == "Annual Leave") {
                                                                        if ('{{leaves.no_of_days}}' >= 9) {
                                                                            $(`.paidleave_hr{{forloop.counter}}`).val('{{pl}}');
                                                                        }
                                                                        else {
                                                                            $(`.paidleave_hr{{forloop.counter}}`).val('{{leaves.no_of_days}}');
                                                                        }
                                                                        if ('{{pl}}' == 0) {
                                                                            $(`.paidleave_hr{{forloop.counter}}`).val("0");
                                                                        }
                                                                    }
                                                                    if (leave_type_hr == "Normal Leave") {
                                                                        // alert('{{leaves.no_of_days}}')
                                                                        if ('{{leaves.no_of_days}}' >= 9) {
                                                                            $(`.paidleave_hr{{forloop.counter}}`).val('{{pl}}');
                                                                        }
                                                                        else {
                                                                            $(`.paidleave_hr{{forloop.counter}}`).val('{{leaves.no_of_days}}');
                                                                        }
                                                                        if ('{{pl}}' == 0) {
                                                                            $(`.paidleave_hr{{forloop.counter}}`).val("0");
                                                                        }
                                                                    }
                                                                    if (leave_type_hr == "Working From Home") {
                                                                        if ('{{leaves.no_of_days}}' >= 9) {
                                                                            $(`.paidleave_hr{{forloop.counter}}`).val('{{pl}}');
                                                                        }
                                                                        else {
                                                                            $(`.paidleave_hr{{forloop.counter}}`).val('{{leaves.no_of_days}}');
                                                                        }
                                                                        if ('{{pl}}' == 0) {
                                                                            $(`.paidleave_hr{{forloop.counter}}`).val("0");
                                                                        }
                                                                    }
                                                                    var leave_status = $("#leave_status_hr{{forloop.counter}}").html().trim(); // Use trim to remove leading/trailing spaces if any

                                                                    //console.log("Leave Status:", leave_status); // Log the leave status to the console for debugging

                                                                    // if (leave_status === 'Rejected' || leave_status === 'Approved') {
                                                                    //     $(".buttons-hide_hr{{forloop.counter}}").hide();   // Approve
                                                                    // } else {
                                                                    //     $(".buttons1-hide_hr{{forloop.counter}}").show();  // Rejected
                                                                    // }

                                                                    if (leave_status == 'Rejected') {
                                                                        $(".buttons-hide_hr{{forloop.counter}}").show();
                                                                        $(".buttons1-hide_hr{{forloop.counter}}").hide();
                                                                    } else if (leave_status == 'Approved') {
                                                                        $(".buttons1-hide_hr{{forloop.counter}}").show();
                                                                        $(".buttons-hide_hr{{forloop.counter}}").hide();
                                                                    } else {
                                                                        $(".buttons1-hide_hr{{forloop.counter}}").show();
                                                                        $(".buttons-hide_hr{{forloop.counter}}").show();
                                                                    }

                                                                    if (leave_status == 'Rejected') {
                                                                        $(".status_hr{{forloop.counter}}").addClass('red');
                                                                    } else if (leave_status == 'Approved') {
                                                                        $(".status_hr{{forloop.counter}}").addClass('green');
                                                                    } else {
                                                                        $(".status_hr{{forloop.counter}}").addClass('black');
                                                                    }
                                                                });
                                                            });
                                                        </script>
                                                        {% endfor %}
                                                    </tbody>

                                                </table>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

            </div>

            <!-- Manager Section -->
            <div class="tab-pane fade" id="pills-managerReport" role="tabpanel" aria-labelledby="pills-home-tab">
                <div class="col-md-12" style="padding: unset;">
                    <div class="card ctm-border-radius shadow-sm grow">
                        <div class="card-header">
                            <h4 class="card-title mb-0">Manager Leave Data</h4>
                        </div>
                        <div class="card-body">
                            <div class="row pageinationAdj">
                                <div class="col-md-6 data_drop2"></div>
                                <div class="col-md-6 data_search2"></div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <form method="post">
                                        {%csrf_token%}
                                        <div class="employee-office-table paginate-table2">
                                            <div class="table-responsive modalHeight">
                                                <table class="table custom-table mb-0" id="myTable2">
                                                    <thead style="position: sticky;
                                                    top: 0;
                                                    z-index: 1;">
                                                        <tr class="thcolor">
                                                            <th>Manager</th>
                                                            <th>Leave Type</th>
                                                            <th>From</th>
                                                            <th>To</th>
                                                            <th>Remaining Leaves</th>
                                                            <th>Days</th>
                                                            <th>Paid Leave</th>
                                                            <th>Status</th>
                                                            <th>Notes</th>
                                                            <th style="display: none;"></th>

                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for sl,pl,leaves in manager_leaves %}
                                                        <tr class="tdcolor">
                                                            <td>
                                                                <h2>{{leaves.emp_name}}</h2>
                                                            </td>
                                                            <td><input type="hidden"
                                                                    class="leave_type_mngr leave_type_mngr{{forloop.counter}}"
                                                                    value="{{leaves.leave_type}}">Sick Leave</td>
                                                            <td>{{leaves.from_dt}}</td>
                                                            <td>{{leaves.to_dt}}</td>
                                                            <td id="">
                                                                <input type="hidden" id="remainleaves"
                                                                    class="remainleaves_mngr{{forloop.counter}}"
                                                                    value="{{pl}}" /><input type="hidden" id="sickleave"
                                                                    class="sickleave_mngr{{forloop.counter}}"
                                                                    value="{{sl}}" />{{sl}}
                                                                SL/{{pl}}
                                                                PL
                                                            </td>
                                                            <td><input type="hidden" id="daysleave"
                                                                    class="daysleave daysleave_mngr{{forloop.counter}}"
                                                                    value="{{leaves.no_of_days}}">{{leaves.no_of_days}}
                                                            </td>
                                                            <td class=""><input type="text" id="paidleave"
                                                                    class="paidleave paidleave_mngr{{forloop.counter}}"
                                                                    value=""
                                                                    style="text-align: center; border: none; background: transparent;">
                                                            </td>
                                                            <td id="leave_status_mngr{{forloop.counter}}"
                                                                class="status_mngr{{forloop.counter}}">{{leaves.status}}
                                                            </td>
                                                            <td hidden class="notes notes2"
                                                                id="notes{{forloop.counter}}">
                                                                {{leaves.reason}}</td>
                                                            <td><span class="showEmail lnr lnr-bubble mr-2"
                                                                    data-title="{{leaves.reason}}"></span></td>

                                                        </tr>
                                                        <div class="modal fade" id="abcshow" tabindex="-1"
                                                            aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                            <div class="modal-dialog">
                                                                <div class="modal-content">
                                                                    <div class="modal-header">
                                                                        <h5 class="modal-title" id="exampleModalLabel">
                                                                            <b>Note</b>
                                                                        </h5>
                                                                        <button type="button" class="close"
                                                                            data-dismiss="modal" aria-label="Close">
                                                                            <span aria-hidden="true">&times;</span>
                                                                        </button>
                                                                    </div>
                                                                    <div class="modal-body">
                                                                        <p id="defbodyshow"></p>
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button type="button"
                                                                            class="btn btn-danger text-white ctm-border-radius mt-4"
                                                                            data-dismiss="modal">Close</button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <script>
                                                            document.getElementById('myTable2').addEventListener('click', function (event) {
                                                                const target = event.target;

                                                                if (target.classList.contains('showEmail')) {
                                                                    const row = target.parentElement.parentElement;
                                                                    const email = row.getElementsByTagName('td')[8].innerText;

                                                                    document.getElementById('defbodyshow').innerText = email;
                                                                    $('#abcshow').modal('show');
                                                                }
                                                            });
                                                        </script>
                                                        <script>
                                                            $(document).ready(function () {
                                                                $(`#myTable2 .leave_type_mngr`).each(function () {
                                                                    var leave_type_mngr = $(`.leave_type_mngr{{forloop.counter}}`).val();
                                                                    var daysleave_mngr = $(`.daysleave_mngr{{forloop.counter}}`).val();
                                                                    var remainleaves_mngr = $(`.remainleaves_mngr{{forloop.counter}}`).val();
                                                                    var sickleave_mngr = $(`.sickleave_mngr{{forloop.counter}}`).val();
                                                                    if (leave_type_mngr == "Sick Leave") {
                                                                        // alert('{{sl}}')
                                                                        if ('{{leaves.no_of_days}}' >= '{{sl}}') {
                                                                            $(`.paidleave_mngr{{forloop.counter}}`).val('{{sl}}');
                                                                        }
                                                                        else {
                                                                            $(`.paidleave_mngr{{forloop.counter}}`).val('{{leaves.no_of_days}}');
                                                                        }
                                                                        if ('{{sl}}' == 0) {
                                                                            $(`.paidleave_mngr{{forloop.counter}}`).val("0");
                                                                        }
                                                                    }
                                                                    if (leave_type_mngr == "Parental Leave") {
                                                                        // alert(remainleaves)
                                                                        if ('{{leaves.no_of_days}}' >= 9) {
                                                                            $(`.paidleave_mngr{{forloop.counter}}`).val('{{pl}}');
                                                                        }
                                                                        else {
                                                                            $(`.paidleave_mngr{{forloop.counter}}`).val('{{leaves.no_of_days}}');
                                                                        }
                                                                        if ('{{pl}}' == 0) {
                                                                            $(`.paidleave_mngr{{forloop.counter}}`).val("0");
                                                                        }
                                                                    }
                                                                    if (leave_type_mngr == "Annual Leave") {
                                                                        if ('{{leaves.no_of_days}}' >= 9) {
                                                                            $(`.paidleave_mngr{{forloop.counter}}`).val('{{pl}}');
                                                                        }
                                                                        else {
                                                                            $(`.paidleave_mngr{{forloop.counter}}`).val('{{leaves.no_of_days}}');
                                                                        }
                                                                        if ('{{pl}}' == 0) {
                                                                            $(`.paidleave_mngr{{forloop.counter}}`).val("0");
                                                                        }
                                                                    }
                                                                    if (leave_type_mngr == "Normal Leave") {
                                                                        // alert('{{leaves.no_of_days}}')
                                                                        if ('{{leaves.no_of_days}}' >= 9) {
                                                                            $(`.paidleave_mngr{{forloop.counter}}`).val('{{pl}}');
                                                                        }
                                                                        else {
                                                                            $(`.paidleave_mngr{{forloop.counter}}`).val('{{leaves.no_of_days}}');
                                                                        }
                                                                        if ('{{pl}}' == 0) {
                                                                            $(`.paidleave_mngr{{forloop.counter}}`).val("0");
                                                                        }
                                                                    }
                                                                    if (leave_type_mngr == "Working From Home") {
                                                                        if ('{{leaves.no_of_days}}' >= 9) {
                                                                            $(`.paidleave_mngr{{forloop.counter}}`).val('{{pl}}');
                                                                        }
                                                                        else {
                                                                            $(`.paidleave_mngr{{forloop.counter}}`).val('{{leaves.no_of_days}}');
                                                                        }
                                                                        if ('{{pl}}' == 0) {
                                                                            $(`.paidleave_mngr{{forloop.counter}}`).val("0");
                                                                        }
                                                                    }
                                                                    var leave_status_mngr = $("#leave_status_mngr{{forloop.counter}}").html().trim();
                                                                    // console.log(leave_status_mngr);
                                                                    // if (leave_status_mngr === 'Rejected' || leave_status_mngr === 'Approved') {
                                                                    //     $(".buttons-hide_mngr{{forloop.counter}}").hide();
                                                                    // } else {
                                                                    //     $(".buttons-hide_mngr{{forloop.counter}}").show();
                                                                    // }
                                                                    if (leave_status_mngr === 'Rejected') {
                                                                        $(".status_mngr{{forloop.counter}}").addClass('red');
                                                                    } else if (leave_status_mngr === 'Approved') {
                                                                        $(".status_mngr{{forloop.counter}}").addClass('green');
                                                                    } else {
                                                                        $(".status_mngr{{forloop.counter}}").addClass('black');
                                                                    }
                                                                });
                                                            });
                                                        </script>
                                                        {% endfor %}
                                                    </tbody>

                                                </table>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <!-- Employee Section -->
            <div class="tab-pane fade" id="pills-empReport" role="tabpanel" aria-labelledby="pills-home-tab">
                <div class="col-md-12" style="padding: unset;">
                    <div class="card ctm-border-radius shadow-sm grow">
                        <div class="card-header">
                            <h4 class="card-title mb-0">Employee Leave Data</h4>
                        </div>
                        <div class="card-body">
                            <div class="row pageinationAdj">
                                <div class="col-md-6 data_drop3"></div>
                                <div class="col-md-6 data_search3"></div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <form method="post">
                                        {%csrf_token%}
                                        <div class="employee-office-table paginate-table3">
                                            <div class="table-responsive modalHeight">
                                                <table class="table custom-table mb-0" id="myTable3">
                                                    <thead style="position: sticky;
                                                    top: 0;
                                                    z-index: 1;">
                                                        <tr class="thcolor">
                                                            <th>Employee</th>
                                                            <th>Leave Type</th>
                                                            <th>From</th>
                                                            <th>To</th>
                                                            <th>Remaining Leaves</th>
                                                            <th>Days</th>
                                                            <th>Paid Leave</th>
                                                            <th>Status</th>
                                                            <th>Notes</th>
                                                            <th style="display:none"></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for sl,pl,leaves in employee_leaves %}
                                                        <tr class="tdcolor">
                                                            <td>
                                                                <h2>{{leaves.emp_name}}</h2>
                                                            </td>
                                                            <td><input type="hidden"
                                                                    class="leave_type_emp leave_type_emp{{forloop.counter}}"
                                                                    value="{{leaves.leave_type}}">Sick Leave</td>
                                                            <td>{{leaves.from_dt}}</td>
                                                            <td>{{leaves.to_dt}}</td>
                                                            <td id="">
                                                                <input type="hidden" id="remainleaves"
                                                                    class="remainleaves_emp{{forloop.counter}}"
                                                                    value="{{pl}}" /><input type="hidden" id="sickleave"
                                                                    class="sickleave_emp{{forloop.counter}}"
                                                                    value="{{sl}}" />{{sl}}
                                                                SL/{{pl}}
                                                                PL
                                                            </td>
                                                            <td><input type="hidden" id="daysleave"
                                                                    class="daysleave daysleave_emp{{forloop.counter}}"
                                                                    value="{{leaves.no_of_days}}">{{leaves.no_of_days}}
                                                            </td>
                                                            <td class=""><input type="text" id="paidleave"
                                                                    class="paidleave paidleave_emp{{forloop.counter}}"
                                                                    value=""
                                                                    style="text-align: center; border: none; background: transparent;">
                                                            </td>
                                                            <td id="leave_status_emp{{forloop.counter}}"
                                                                class="status_emp{{forloop.counter}}">{{leaves.status}}
                                                            </td>
                                                            <td hidden class="notes notes3"
                                                                id="notes{{forloop.counter}}">{{leaves.reason}}</td>

                                                            <td><span class="showEmail lnr lnr-bubble mr-2"
                                                                    data-title="{{leaves.reason}}"></span></td>
                                                            </td>
                                                            <!--  -->
                                                        </tr>
                                                        <!-- Bootstrap Modal -->
                                                        <div class="modal fade" id="pqrshow" tabindex="-1"
                                                            aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                            <div class="modal-dialog">
                                                                <div class="modal-content">
                                                                    <div class="modal-header">
                                                                        <h5 class="modal-title" id="exampleModalLabel">
                                                                            <b>Note</b>
                                                                        </h5>
                                                                        <button type="button" class="close"
                                                                            data-dismiss="modal" aria-label="Close">
                                                                            <span aria-hidden="true">&times;</span>
                                                                        </button>
                                                                    </div>
                                                                    <div class="modal-body">
                                                                        <p id="xyzshow"></p>
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button type="button"
                                                                            class="btn btn-danger text-white ctm-border-radius mt-4"
                                                                            data-dismiss="modal">Close</button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <script>
                                                            document.getElementById('myTable3').addEventListener('click', function (event) {
                                                                const target = event.target;

                                                                if (target.classList.contains('showEmail')) {
                                                                    const row = target.parentElement.parentElement;
                                                                    const email = row.getElementsByTagName('td')[8].innerText;

                                                                    document.getElementById('xyzshow').innerText = email;
                                                                    $('#pqrshow').modal('show');
                                                                }
                                                            });
                                                        </script>
                                                        <script>
                                                            $(document).ready(function () {
                                                                $(`#myTable3 .leave_type_emp`).each(function () {
                                                                    var leave_type_emp = $(`.leave_type_emp{{forloop.counter}}`).val();
                                                                    var daysleave_emp = $(`.daysleave_emp{{forloop.counter}}`).val();
                                                                    var remainleaves_emp = $(`.remainleaves_emp{{forloop.counter}}`).val();
                                                                    var sickleave_emp = $(`.sickleave_emp{{forloop.counter}}`).val();
                                                                    if (leave_type_emp == "Sick Leave") {
                                                                        // alert('{{sl}}')
                                                                        if ('{{leaves.no_of_days}}' >= '{{sl}}') {
                                                                            $(`.paidleave_emp{{forloop.counter}}`).val('{{sl}}');
                                                                        }
                                                                        else {
                                                                            $(`.paidleave_emp{{forloop.counter}}`).val('{{leaves.no_of_days}}');
                                                                        }
                                                                        if ('{{sl}}' == 0) {
                                                                            $(`.paidleave_emp{{forloop.counter}}`).val("0");
                                                                        }
                                                                    }
                                                                    if (leave_type_emp == "Parental Leave") {
                                                                        // alert(remainleaves)
                                                                        if ('{{leaves.no_of_days}}' >= 9) {
                                                                            $(`.paidleave_emp{{forloop.counter}}`).val('{{pl}}');
                                                                        }
                                                                        else {
                                                                            $(`.paidleave_emp{{forloop.counter}}`).val('{{leaves.no_of_days}}');
                                                                        }
                                                                        if ('{{pl}}' == 0) {
                                                                            $(`.paidleave_emp{{forloop.counter}}`).val("0");
                                                                        }
                                                                    }
                                                                    if (leave_type_emp == "Annual Leave") {
                                                                        if ('{{leaves.no_of_days}}' >= 9) {
                                                                            $(`.paidleave_emp{{forloop.counter}}`).val('{{pl}}');
                                                                        }
                                                                        else {
                                                                            $(`.paidleave_emp{{forloop.counter}}`).val('{{leaves.no_of_days}}');
                                                                        }
                                                                        if ('{{pl}}' == 0) {
                                                                            $(`.paidleave_emp{{forloop.counter}}`).val("0");
                                                                        }
                                                                    }
                                                                    if (leave_type_emp == "Normal Leave") {
                                                                        // alert('{{leaves.no_of_days}}')
                                                                        if ('{{leaves.no_of_days}}' >= 9) {
                                                                            $(`.paidleave_emp{{forloop.counter}}`).val('{{pl}}');
                                                                        }
                                                                        else {
                                                                            $(`.paidleave_emp{{forloop.counter}}`).val('{{leaves.no_of_days}}');
                                                                        }
                                                                        if ('{{pl}}' == 0) {
                                                                            $(`.paidleave_emp{{forloop.counter}}`).val("0");
                                                                        }
                                                                    }
                                                                    if (leave_type_emp == "Working From Home") {
                                                                        if ('{{leaves.no_of_days}}' >= 9) {
                                                                            $(`.paidleave_emp{{forloop.counter}}`).val('{{pl}}');
                                                                        }
                                                                        else {
                                                                            $(`.paidleave_emp{{forloop.counter}}`).val('{{leaves.no_of_days}}');
                                                                        }
                                                                        if ('{{pl}}' == 0) {
                                                                            $(`.paidleave_emp{{forloop.counter}}`).val("0");
                                                                        }
                                                                    }
                                                                    var leave_status_emp = $("#leave_status_emp{{forloop.counter}}").html().trim();
                                                                    // console.log(leave_status);
                                                                    if (leave_status_emp === 'Rejected' || leave_status_emp === 'Approved') {
                                                                        $(".buttons-hide_emp{{forloop.counter}}").hide();
                                                                    } else {
                                                                        $(".buttons-hide_emp{{forloop.counter}}").show();
                                                                    }
                                                                    if (leave_status_emp == 'Rejected') {
                                                                        $(".status_emp{{forloop.counter}}").addClass('red');
                                                                    } else if (leave_status_emp == 'Approved') {
                                                                        $(".status_emp{{forloop.counter}}").addClass('green');
                                                                    } else {
                                                                        $(".status_emp{{forloop.counter}}").addClass('black');
                                                                    }
                                                                });
                                                            });
                                                        </script>
                                                        {% endfor %}
                                                    </tbody>

                                                </table>
                                            </div>
                                        </div>
                                    </form>

                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% block paginate %}
    <script src="../static/js/jquery.dataTables.min.js"></script>
    <script src="../static/js/dataTables.bootstrap.min.js"></script>
    {% endblock paginate %}
    <script>
        $(document).ready(function () {
            $("#myTable1").DataTable({
                "lengthMenu": [50, 100, 150, 200],
                "pageLength": 50,
                lengthChange: true,
                info: true,
                initComplete: (settings, json) => {
                    $('#myTable1_paginate, #myTable1_info').appendTo('.paginate-table1');
                    $('#myTable1_length').appendTo('.data_drop1');
                    $('#myTable1_filter').appendTo('.data_search1');
                },
            });
            $("#myTable2").DataTable({
                "lengthMenu": [50, 100, 150, 200],
                "pageLength": 50,
                lengthChange: true,
                info: true,
                initComplete: (settings, json) => {
                    $('#myTable2_paginate, #myTable2_info').appendTo('.paginate-table2');
                    $('#myTable2_length').appendTo('.data_drop2');
                    $('#myTable2_filter').appendTo('.data_search2');
                },
            });
            $("#myTable3").DataTable({
                "lengthMenu": [50, 100, 150, 200],
                "pageLength": 50,
                lengthChange: true,
                info: true,
                initComplete: (settings, json) => {
                    $('#myTable3_paginate, #myTable3_info').appendTo('.paginate-table3');
                    $('#myTable3_length').appendTo('.data_drop3');
                    $('#myTable3_filter').appendTo('.data_search3');
                },
            });
        });
    </script>
    <script src="../static/js/bootstrap.min.js"></script>
    <script>
        $(document).ready(function () {
            // Handle row clicks
            $("table").on("click", "tbody tr", function () {
                $(this).toggleClass("drkclick");
            });
            $("table").on("click", "tbody tr", function () {
                $(this).toggleClass("tdcolor");
            });
        });
    </script>
    <script>
        $(document).ready(function () {
            // $("vj1").hide();
            $("#fullscreen").click(function () {
                $("#sidebarid").hide();
                $(".adminleave").css({ "max-width": "100%", "flex": "0 0 100%" });
                $(this).hide();
                $("#showsidebar").show();
            });
        });
    </script>

    <script>
        $(document).ready(function () {
            $("#showsidebar").hide();
            $("#showsidebar").click(function () {
                $("#sidebarid").show();
                if($(window).width() > 991 && $(window).width() < 1200){
                    $(".adminleave").css({ "max-width": "66%", "flex": "0 0 66%" });
                }
                else{
                    $(".adminleave").css({ "max-width": "75%", "flex": "0 0 75%" });
                }
                $(this).hide();
                $("#fullscreen").show();
            });
        });
    </script>
    {% endblock body %}